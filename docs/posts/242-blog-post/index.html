<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hylaea Miller">
<meta name="dcterms.date" content="2025-12-10">
<meta name="description" content="A case study analysis of how geographical sampling bias in bird habitat models leads to flawed conservation decisions, with practical solutions for addressing data bias in environmental science.">

<title>Where We Look Determines What We Find: How Sampling Bias Threatens Steppe Bird Conservation – Hylaea Miller</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-499766b1ed5b0e89bfb6b31b1cb35d22.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="quarto:status" content="draft">


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Hylaea Miller</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Where We Look Determines What We Find: How Sampling Bias Threatens Steppe Bird Conservation</h1>
                  <div>
        <div class="description">
          A case study analysis of how geographical sampling bias in bird habitat models leads to flawed conservation decisions, with practical solutions for addressing data bias in environmental science.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Hylaea Miller </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 10, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-case" id="toc-the-case" class="nav-link" data-scroll-target="#the-case">The Case:</a>
  <ul class="collapse">
  <li><a href="#effects-of-geographical-data-sampling-bias-on-habitat-models-of-species-distributions-a-case-study-with-steppe-birds-in-southern-portugal" id="toc-effects-of-geographical-data-sampling-bias-on-habitat-models-of-species-distributions-a-case-study-with-steppe-birds-in-southern-portugal" class="nav-link" data-scroll-target="#effects-of-geographical-data-sampling-bias-on-habitat-models-of-species-distributions-a-case-study-with-steppe-birds-in-southern-portugal">Effects of geographical data sampling bias on habitat models of species distributions: a case study with steppe birds in southern Portugal</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions:</a>
  <ul class="collapse">
  <li><a href="#improved-sampling-design" id="toc-improved-sampling-design" class="nav-link" data-scroll-target="#improved-sampling-design">Improved Sampling Design</a></li>
  <li><a href="#bias-characterization" id="toc-bias-characterization" class="nav-link" data-scroll-target="#bias-characterization">Bias Characterization</a></li>
  <li><a href="#transparency-and-uncertainty-communication" id="toc-transparency-and-uncertainty-communication" class="nav-link" data-scroll-target="#transparency-and-uncertainty-communication">Transparency and Uncertainty Communication</a></li>
  </ul></li>
  <li><a href="#applicability-to-other-cases" id="toc-applicability-to-other-cases" class="nav-link" data-scroll-target="#applicability-to-other-cases">Applicability to Other Cases</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Imagine conservation planners creating a nature reserve based on maps showing where endangered birds live, only to discover later that the maps were misleading, not because the science was wrong, but because researchers had accidentally surveyed the wrong places. This isn’t a hypothetical scenario. It’s a real problem affecting biodiversity conservation worldwide, and it comes from a subtle but widespread issue: geographical sampling bias.</p>
<p>In the cereal steppes of southern Portugal, a team of researchers uncovered a troubling reality about how we collect and use data to protect bird species. Their findings reveal that where we choose to look for wildlife can distort our understanding of where animals actually live, with potentially serious consequences for conservation efforts. This case study examines how geographical sampling bias in habitat models led to misleading predictions about steppe bird distributions, and what it teaches us about the hidden pitfalls in environmental data collection.</p>
</section>
<section id="the-case" class="level2">
<h2 class="anchored" data-anchor-id="the-case">The Case:</h2>
<section id="effects-of-geographical-data-sampling-bias-on-habitat-models-of-species-distributions-a-case-study-with-steppe-birds-in-southern-portugal" class="level3">
<h3 class="anchored" data-anchor-id="effects-of-geographical-data-sampling-bias-on-habitat-models-of-species-distributions-a-case-study-with-steppe-birds-in-southern-portugal">Effects of geographical data sampling bias on habitat models of species distributions: a case study with steppe birds in southern Portugal</h3>
<section id="the-data-and-the-problem" class="level4">
<h4 class="anchored" data-anchor-id="the-data-and-the-problem">The Data and the Problem</h4>
<p>Between March and June 2004, researchers led by Pedro Leitão surveyed 560 sites across the Baixo Alentejo region of southern Portugal, documenting nine species of steppe birds including the Great Bustard, Stone Curlew, and Calandra Lark. The researchers designed their sampling scheme carefully using stratified random sampling across the entire region to ensure balanced, unbiased coverage of different habitat types and geographical areas.</p>
<p>After collecting this baseline dataset, considered to be as complete and unbiased as practically possible, the research team deliberately degraded their own data. They created multiple subsampled datasets that mimicked common real-world sampling biases, removing 80-90% of observations in patterns that reflected how field surveys typically occur. Some subsamples concentrated observations near road networks, and others near protected areas. These artificially biased datasets became experiments to test how geographical sampling bias affects the habitat models of species distributions</p>
</section>
<section id="identifying-the-bias" class="level4">
<h4 class="anchored" data-anchor-id="identifying-the-bias">Identifying the Bias</h4>
<p>The type of bias examined in this study is geographical sampling bias, specifically spatial clustering of observation points. This occurs when data collection is systematically concentrated in certain geographical areas while other areas remain undersampled. The researchers identified this bias through spatial analysis of their deliberately subsampled datasets, measuring both the spatial distribution of sampling points and the representation of environmental conditions in each biased dataset compared to the comprehensive baseline.</p>
<p>When observations clustered near roads or protected areas, the resulting datasets failed to adequately represent the full range of environmental conditions present across the landscape. Agricultural areas far from roads, certain elevation ranges, and specific vegetation types became severely underrepresented.</p>
</section>
<section id="the-consequences" class="level4">
<h4 class="anchored" data-anchor-id="the-consequences">The Consequences</h4>
<p>When the team built habitat suitability models using these biased datasets, the predictions diverged considerably from those based on unbiased data. Road-biased models predicted high suitability in easily accessible areas while systematically underestimating habitat quality in remote locations. Protected area-biased models overemphasized characteristics found within reserves while missing important habitats elsewhere. These shifts in predicted bird occurrence patterns were substantial, yet the biased models often appeared statistically adequate, creating false confidence in fundamentally flawed results that would lead conservation efforts to prioritize the wrong areas for protection.</p>
</section>
</section>
</section>
<section id="reflection" class="level2">
<h2 class="anchored" data-anchor-id="reflection">Reflection</h2>
<p>This case study shows a troubling pattern in environmental science: our data often reflects where we can easily collect observations rather than where observations should be collected to answer our questions. The Portugal steppe birds study demonstrates a form of selection bias, specifically, a bias arising from the process of selecting sampling locations based on convenience rather than representative coverage. As Frampton et al.&nbsp;(2022) and Konno et al.&nbsp;(2023) explain, selection biases occur when the way we choose what to measure systematically excludes certain populations or conditions. In this case, road-biased and protected area-biased sampling created datasets that fundamentally misrepresented the environmental conditions across the landscape.</p>
<p>What makes geographical sampling bias particularly challenging is its invisibility. A biased dataset can look complete if you don’t consider where observations are missing, the data can still produce models that are internally consistent and statistically well-behaved, while being systematically inaccurate because the underlying sample misrepresents the true population. This reflects what Olteanu et al.&nbsp;(2019) describe as the “population bias” inherent in many data collection efforts. Though they refer to social data contexts, it can be translated to environmental data, where the sampled population differs systematically from the target population we aim to understand. The steppe bird biased models achieved good fits to their training data, but predicted occurrence patterns that diverged from reality in unsampled areas.</p>
<p>This case also raises questions about the political economy of scientific data collection and what Vera et al.&nbsp;(2019) term “extractive logic” in environmental data practices. Research funding, accessibility constraints, and institutional priorities shape where sampling occurs, often disconnecting data from the communities and landscapes most affected by conservation decisions. Similar patterns of geographic sampling bias have been documented in urban contexts, where Ellis-Soto et al.&nbsp;(2023) found that historically redlined neighborhoods in U.S. cities remain significantly undersampled for bird biodiversity data, demonstrating how structural inequities perpetuate sampling disparities across both rural and urban landscapes, where sites frequently sampled by citizen-science efforts may be in areas of low environmental justice concern. These patterns are rational responses to practical constraints, but they systematically bias our collective knowledge about biodiversity patterns while privileging certain voices and perspectives in conservation science.</p>
<p>This connects directly to principles of environmental data justice, which calls for data practices that are participatory, transparent, and accountable to affected communities rather than extractive and disconnected from context (Vera et al., 2019). In the case of steppe bird conservation, the communities who live in and depend on these landscapes, particularly those in remote areas far from roads and research stations, are rendered invisible by sampling bias, their environments mischaracterized in the very models meant to protect shared biodiversity.</p>
</section>
<section id="solutions" class="level2">
<h2 class="anchored" data-anchor-id="solutions">Solutions:</h2>
<p>Some complementary approaches for addressing geographical sampling bias include:</p>
<section id="improved-sampling-design" class="level3">
<h3 class="anchored" data-anchor-id="improved-sampling-design">Improved Sampling Design</h3>
<p>The most direct solution is better sampling design from the beginning. Stratified random sampling, as used in the baseline Portugal dataset, ensures balanced coverage across geographical space and environmental gradients. While true random sampling is the gold standard, it is often impractical given access constraints and resource limitations, so researchers can implement sampling schemes that deliberately counteract predictable biases.</p>
</section>
<section id="bias-characterization" class="level3">
<h3 class="anchored" data-anchor-id="bias-characterization">Bias Characterization</h3>
<p>When working with existing datasets, characterizing the nature and extent of bias becomes critical. The Portugal researchers demonstrated that quantifying environmental bias, provides insight into how much the data might mislead model predictions. Tools like environmental space analysis can reveal whether sampling adequately covers the range of conditions relevant to the species.</p>
</section>
<section id="transparency-and-uncertainty-communication" class="level3">
<h3 class="anchored" data-anchor-id="transparency-and-uncertainty-communication">Transparency and Uncertainty Communication</h3>
<p>One solution that works universally is the acknowledgment of sampling bias and its implications. When habitat models inform conservation decisions, transparent communication about data limitations should accompany predictions. Maps of sampling effort overlaid with prediction maps would show decision-makers where predictions are well-supported by data versus where they represent extrapolation from biased samples. Uncertainty estimates that account for sampling bias could guide risk-averse conservation strategies that hedge against model uncertainty.</p>
</section>
</section>
<section id="applicability-to-other-cases" class="level2">
<h2 class="anchored" data-anchor-id="applicability-to-other-cases">Applicability to Other Cases</h2>
<p>These solutions can be applied across other environmental science contexts where spatial data guides decisions. Climate monitoring networks face similar biases, with weather stations concentrated in accessible, populated areas. Pollution monitoring suffers from systematic undersampling of disadvantaged communities, and biodiversity databases like GBIF and eBird contain multiple occurrence records with severe spatial bias toward well-studied regions, parks, and roadsides (Ellis-Soto et al., 2023).</p>
<p>The sampling design solutions are universally relevant, as stratified approaches can improve data quality in many geographic contexts, as well as bias characterization. The emphasis on transparency and uncertainty communication should become standard practice whenever spatial data informs high-stakes decisions. However, the specific techniques require adaptation to each context. The analysis that revealed bias in bird habitat data, by examining whether sampling captured the full range of environmental conditions, might translate poorly to pollution monitoring, where the relevant environmental factors look different.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The Portugal steppe birds study demonstrates a problem that permeates environmental science. By deliberately biasing their own dataset, the researchers showed how geographical sampling bias distorts habitat models and misleads conservation efforts. Their work reminds us that the reliability of our environmental knowledge depends on where we looked and where we didn’t.</p>
<p>As environmental data science increasingly shapes policy and management decisions, we must recognize the invisible biases in our data. The maps and models we build reflect the practical constraints, funding priorities, and accessibility patterns that determined where we collected observations. Acknowledging and accounting for this reality should become standard practice in environmental science.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References:</h2>
<p>Ellis-Soto, D., Chapman, M. &amp; Locke, D.H. Historical redlining is associated with increasing geographical disparities in bird biodiversity sampling in the United States. Nat Hum Behav 7, 1869–1877 (2023). https://doi.org/10.1038/s41562-023-01688-5</p>
<p>Frampton, G., Whaley, P., Bennett, M. et al.&nbsp;Principles and framework for assessing the risk of bias for studies included in comparative quantitative environmental systematic reviews. Environ Evid 11, 12 (2022). https://doi.org/10.1186/s13750-022-00264-0</p>
<p>Konno, K., Gibbons, J., Lewis, R. et al.&nbsp;Potential types of bias when estimating causal effects in environmental research and how to interpret them. Environ Evid 13, 1 (2024). https://doi.org/10.1186/s13750-024-00324-7</p>
<p>Leitão, P. J., Moreira, F., &amp; Osborne, P. E. (2011). Effects of geographical data sampling bias on habitat models of species distributions: a case study with steppe birds in southern Portugal. International Journal of Geographical Information Science, 25(3), 439–454. https://doi.org/10.1080/13658816.2010.531020</p>
<p>Olteanu, A., Castillo, C., Diaz, F., &amp; Kıcıman, E. (2019). Social data: Biases, methodological pitfalls, and ethical boundaries. Frontiers in Big Data, 2, 13. https://doi.org/10.3389/fdata.2019.00013</p>
<p>Vera, L. A., Walker, D., Murphy, M., Mansfield, B., Siad, L. M., &amp; Ogden, J. (2019). When data justice and environmental justice meet: formulating a response to extractive logic through environmental data justice. Information, Communication &amp; Society, 22(7), 1012–1028. https://doi.org/10.1080/1369118X.2019.1596293</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>